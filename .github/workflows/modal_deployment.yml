name: CI/CD

on:
  push:
    branches:
      - main

jobs:

  set_environment:
    runs-on: ubuntu-latest
    steps:
      - name: Get Branch Name
        run: echo "BRANCH_NAME=$(echo ${GITHUB_REF#refs/heads/})"
        id: get_branch_name

  deploy:
    name: Deploy
    environment: ${{ needs.set_environment.outputs.BRANCH_NAME }}
    runs-on: ubuntu-latest
    env:
      MODAL_TOKEN_ID: ${{ secrets.MODAL_TOKEN_ID }}
      MODAL_TOKEN_SECRET: ${{ secrets.MODAL_TOKEN_SECRET }}
      TEST_VAR: 'dev'

    steps:

      - name: print shit

        run: |
          echo "MODAL_TOKEN_ID: ${{ secrets.MODAL_TOKEN_ID }}"
          echo "MODAL_TOKEN_SECRET: ${{ secrets.MODAL_TOKEN_SECRET }}"
          echo "TEST_VAR: ${{ env.TEST_VAR }}"
          echo "GITHUB_REF: ${GITHUB_REF#refs/heads/}"
          echo "BRANCH: $(git rev-parse --abbrev-ref HEAD)"

      # - name: Checkout Repository
      #   uses: actions/checkout@v2

      # - name: Install Python
      #   uses: actions/setup-python@v2
      #   with:
      #     python-version: "3.9"

      # - name: Install Modal
      #   run: |
      #     python -m pip install --upgrade pip
      #     pip install modal-client

      # - name: Deploy job
      #   run: |
      #     modal deploy gpu_deployments.modal_deployments.test_githubactions_modal